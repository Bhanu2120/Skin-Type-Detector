<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Sign Up</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @keyframes slideUpFadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
#signup-form > *, #login-form > * {
  opacity: 0;
  animation: slideUpFadeIn 0.5s ease-out forwards;
}
/* Title */
#signup-form h2, #login-form h2 {
  animation-delay: 0.2s;
}
/* First Input */
#signup-form .form-group:nth-of-type(1),
#login-form .form-group:nth-of-type(1) {
  animation-delay: 0.3s;
}
/* Second Input */
#signup-form .form-group:nth-of-type(2),
#login-form .form-group:nth-of-type(2) {
  animation-delay: 0.4s;
}
/* Third Input (Signup only) */
#signup-form .form-group:nth-of-type(3) {
  animation-delay: 0.5s;
}
/* Fourth Input (Signup only) */
#signup-form .form-group:nth-of-type(4) {
  animation-delay: 0.6s;
}
/* Button */
#signup-form .btn, #login-form .btn {
  animation-delay: 0.7s;
}
/* "Already have an account?" text */
#signup-form p, #login-form p {
  animation-delay: 0.8s;
}
@media (max-width: 768px) {
  .container {
    width: 90%;
    padding: 30px 20px;
  }
  h2 {
    font-size: 1.8rem;
  }
}
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #a3d9ff, #ffffff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: #ffffffcc;
      border-radius: 25px;
      padding: 40px 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      width: 350px;
      text-align: center;
      transition: all 0.3s ease;
    }

    h2 {
      color: #00bfff;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 5px;
      color: #0077aa;
    }

    input {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #00bfff;
      border-radius: 20px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    input:focus {
      border-color: #0099cc;
      box-shadow: 0 0 5px #00bfff33;
    }

    .btn {
      width: 100%;
      padding: 12px 0;
      margin: 10px 0;
      border-radius: 50px;
      border: none;
      background: #00bfff;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #0099cc;
    }

    .toggle-link {
      color: #00bfff;
      cursor: pointer;
      font-weight: bold;
    }

    .toggle-link:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }

    .navigation {
      margin-top: 20px;
      text-align: center;
    }

    .navigation .btn {
      width: auto;
      padding: 8px 20px;
      font-size: 16px;
      margin: 5px;
    }
    html, body{ 
      overflow: hidden;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="container">


    <!-- SIGNUP FORM -->
    <div id="signup-form">
          <h2>Sign Up</h2>
      <div class="form-group">
        <label for="signup-name">Enter Name:</label>
        <input type="text" id="signup-name" placeholder="Your Gorgeous Name" pattern="[A-Za-z ]+" required>
      </div>
      <div class="form-group">
        <label for="signup-phone">Enter Phone:</label>
        <input type="text" id="signup-phone" placeholder="Your Number" pattern="[0-9]+" required>
      </div>
      <div class="form-group">
        <label for="signup-email">Enter Email:</label>
        <input type="email" id="signup-email" placeholder="Your Email" required>
      </div>
      <div class="form-group">
        <label for="signup-password">Enter Password:</label>
        <input type="password" id="signup-password" placeholder="Make it secure" required>
      </div>
      <button class="btn" onclick="signup()">Sign Up</button>
      <p>Already have an account? <span class="toggle-link" onclick="toggleForms()">Login</span></p>
    </div>

    <!-- LOGIN FORM -->
  
    <div id="login-form" class="hidden">
          <h2>Login</h2>
      <div class="form-group">
        <label for="login-email">Email:</label>
        <input type="email" id="login-email" placeholder="Enter Email" required>
      </div>
      <div class="form-group">
        <label for="login-password">Password:</label>
        <input type="password" id="login-password" placeholder="Enter Password" required>
      </div>
      <button class="btn" onclick="login()">Login</button>
      <p>Don’t have an account? <span class="toggle-link" onclick="toggleForms()">Sign Up</span></p>
    </div>
  </div>

  <div class="navigation">
    <a href="intro.html" class="btn">← Back</a>
    <a href="precautions.html" class="btn">Next →</a>
  </div>

  <script>
const BACKEND_URL = 'http://127.0.0.1:5000/api'; 

// Toggle between Login and Sign Up
function toggleForms(){
  document.getElementById('signup-form').classList.toggle('hidden');
  document.getElementById('login-form').classList.toggle('hidden');
}

// --- SIGNUP FUNCTION ---
// --- SIGNUP FUNCTION ---
async function signup(){
    const name = document.getElementById('signup-name').value;
    const phone = document.getElementById('signup-phone').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;

    if (!name || !phone || !email || !password) {
        Swal.fire({
          icon: 'warning',
          title: 'Missing Information',
          text: 'Please fill out all fields to sign up!',
          color: '#00558A'
       });
        return;
    }

    try {
        const response = await fetch(`${BACKEND_URL}/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: name, email, password })  // ✅ FIXED: send "username" not "name"
        });

        const result = await response.json();

        if (response.ok) {
            // Show a success pop-up
    Swal.fire({
        icon: 'success',  // This adds the green tick mark!
        title: 'Registered!',
        text: result.message,
        timer: 2000,      // Pop-up will close automatically after 2 seconds
        showConfirmButton: false // Hides the "OK" button
    }).then(() => {
        // This code runs AFTER the pop-up closes
        localStorage.setItem('userId', result.user_id);
        localStorage.setItem('userName', name);
        window.location.href = 'precautions.html';
    });
        } else {
            Swal.fire({
              icon: 'error',
              title: 'Sign Up Failed',
              text: result.message,
              color: '#00558A'
          });
        }
    } catch (error) {
        Swal.fire({
           icon: 'error',
           title: 'Network Error',
           text: 'Could not connect to the server. Please try again later.',
          color: '#00558A'
        });
        console.error(error);
    }
}

 //LOGIN FUNCTION ---
    async function login() {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
            Swal.fire({
              icon: 'warning',
              title: 'Missing Information',
              text: 'Please enter your email and password!',
              color: '#00558A'
            });
            return;
        }

        try {
            const response = await fetch(`${BACKEND_URL}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email,
                    password
                })
            });

            const result = await response.json();

  if (response.ok) {
    Swal.fire({
      icon: 'success',
      title: `Welcome back, ${result.username}!`,
      text: 'You are now logged in.',
      color: '#00558A',
      timer: 2000,
      showConfirmButton: false
    }).then(() => {
      // Store login user info
      localStorage.setItem('userId', result.user_id);
      localStorage.setItem('userName', result.username);
      // Go to precautions page after login
      window.location.href = 'precautions.html';
    });
} else {
    Swal.fire({
      icon: 'error', // This adds a red "X" icon
      title: 'Login Failed',
      text: result.message
    });
  }
} catch (error) {
            Swal.fire({
             icon: 'error',
             title: 'Network Error',
             text: 'Could not connect to the server. Please try again later.',
             color: '#00558A'
            });
            console.error(error);
        }
    }

</script>

</body>
</html>

